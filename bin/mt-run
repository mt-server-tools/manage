#!/bin/bash

# TODO - make configurable
MTDIR=./

mkdir -p "$MTDIR/logs"

while true; do
	d1=$(date "+%s")
	"$MTDIR"/bin/minetestserver --config "$MTDIR"/minetest.conf --logfile "$MTDIR/logs"/minetest.log
	d2=$(date "+%s")
	ds=$(date "+%F%T"|sed -r 's/[^0-9]+/-/g')
	mv "$MTDIR/logs"/minetest.log "$MTDIR/logs"/minetest-"$ds".log
	if [[ "$(( $d2 - $d1 ))" -lt 15 ]]; then
		echo "[1;31mRESTARTED TOO FAST - aborting[0m"
		exit 127
	fi
done
