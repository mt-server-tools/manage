#!/usr/bin/perl

use strict;
use warnings;
use POSIX;

if ($#ARGV < 2) {
	print "\nUsage: mt-action [1;34mPOSX POSY POSZ [RADIUS][0m\nDefault radius range is 10\n\nReads from stdin\n\n";
	exit (0);
}

# Central coords
my $x0 = int($ARGV[0]) or exit(1);
my $y0 = int($ARGV[1]) or exit(1);
my $z0 = int($ARGV[2]) or exit(1);

# Radius, in nodes
my $radius = 10;

if ($#ARGV >= 3) {
	$radius = int($ARGV[3]) or exit(1);
}

# detect place, dig, take, punch, punched by

# grep -P '(at|at protected position) \(.+?\)'|sed -r 's/^.+ACTION\[ServerThread\]: //'

sub inrange {
	my $px = $_[0];
	my $py = $_[1];
	my $pz = $_[2];
	# (x - x0)Â² + (y - y0)Â² + (z - z0)Â² <= rÂ²
	
	return ($px - $x0)**2 + ($py - $y0)**2 + ($pz - $z0)**2 <= $radius ** 2;
}

while (<STDIN>) {
	if ($_ =~ m/(at|at protected position) \(([0-9.,-]+),([0-9.,-]+),([0-9.,-]+)\)/ ) {
		my $px = int(floor($2));
		my $py = int(floor($3));
		my $pz = int(floor($4));
		
		if ( inrange($px,$py,$pz) ) {
			print $_;
		}
	}
}
