#!/bin/bash

playerlist="$(grep -P -o "List of players:.+" /var/log/minetest/minetest.log|sed "s/List of players: //"|tail -n 1)"

if [[ -n "$playerlist" ]]; then
	echo "Players: $playerlist"
	read -p "It seems there are still players online - are you sure? [y/N]> "
	if [[ ! "$REPLY" =~ $(echo '^(yes|YES|y|Y)$') ]]; then
		exit 1
	fi
fi

systemctl restart minetest-server

sleep 3
journalctl -xe -u minetest-server|tail -n 20
